{% comment %}
This is a function to turn YML sidebar definitions into HTML lists.
Based on tip in http://hamishwillee.github.io/2014/11/13/jekyll-includes-are-functions/
{% endcomment %}

{% if include.item.contents %}
    {% assign currentLevel = include.level | plus: 0 %}
    {% assign nextLevel = include.level | plus: 1 %}
    {% if currentLevel < 10 %}
    <li>
        <a href="#">{{ include.item.title }}</a>
        <ul>
            {% for subitem in include.item.contents %}
            {% include /functions/recursive_item_to_list.html item=subitem level=nextLevel %}
            {% endfor %}
        </ul>
    </li>
    {% endif %} {% comment %}if currentLevel < 10 {% endcomment %}
{% else %}
    {% assign item_url_stripped = (include.item.url | remove: "index.html" | replace: ".md", ".html"%}

    {% assign list_item_css_class = "inactive" %}
    {% if page.url == item_url_stripped %}
        {% assign list_item_css_class = "active" %}
    {% else%}
        {% assign list_item_css_class = "inactive" %}
    {% endif %}
    {% assign is_external_link = ((include.item.url contains "http://") or  (include.item.url contains "https://") or (include.item.url contains "ftp://")) %}
    {% if is_external_link%}
    <li><a href="{{include.item.url}}" target="_blank">{{include.item.title}}</a></li>
    {% elsif include.item.url contains "dir://" %}
        {% for site_page in site.pages %}
            {% assign dir_path = (include.item.url | remove: "dir://"%}
            {% if site_page.url contains dir_path %}
                {% if site_page.url == page.url %}
                    {% assign list_item_css_class = "active" %}
                {% else%}
                    {% assign list_item_css_class = "inactive" %}
                {% endif %}
                <li class="{{list_item_css_class}}"><a href="{{site_page.url | prepend: site.baseurl}}">{{site_page.title}}</a></li>
            {% endif %}
        {% endfor %} <!-- page -->
    {% else%}
    <li class="{{list_item_css_class}}"><a href="{{include.item.url | prepend: site.baseurl}}">{{include.item.title}}</a></li>
    {% endif %}
{% endif %}

